<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</title>

<style>
/* ===== Ø¹Ø§Ù… ===== */
body{
  margin:0;
  font-family:"Times New Roman",Tahoma;
  background:linear-gradient(#0f3d2e,#145a32);
  overflow-x:hidden;
}

/* ===== ÙÙˆØ§Ù†ÙŠØ³ Ø¬Ø§Ù†Ø¨ÙŠØ© ===== */
.side{
  position:fixed;
  top:0;
  width:70px;
  height:100vh;
  pointer-events:none;
  z-index:1;
}
.left{left:0}
.right{right:0}

.lantern{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:36px;
  height:64px;
  background:radial-gradient(circle,#fff2b0 0%,#f5a623 60%);
  border-radius:8px;
  box-shadow:0 0 14px rgba(255,215,100,.8);
  animation:fall linear infinite;
}
.lantern::before{
  content:"";
  position:absolute;
  top:-10px;left:50%;
  transform:translateX(-50%);
  width:16px;height:10px;
  background:#444;border-radius:4px 4px 0 0;
}
.lantern::after{
  content:"";
  position:absolute;
  bottom:-8px;left:50%;
  transform:translateX(-50%);
  width:18px;height:8px;
  background:#333;border-radius:0 0 4px 4px;
}
@keyframes fall{
  from{top:-80px}
  to{top:110vh}
}

/* ===== Ø§Ù„ÙƒØ±ÙˆØª ===== */
.card{
  max-width:420px;
  margin:90px auto;
  background:#fff;
  border-radius:12px;
  padding:24px;
  text-align:center;
  display:none;
  position:relative;
  z-index:5;
}
.card.active{display:block}

button,input,select{
  width:100%;
  padding:10px;
  margin-top:12px;
  font-size:14px;
}
button{
  background:#145a32;
  color:#fff;
  border:0;
  border-radius:20px;
  cursor:pointer;
}

/* ===== Spinner ===== */
#spinner{
  display:none;
  margin-top:12px;
  text-align:center;
  font-size:13px;
  color:#555;
}
.loader{
  width:28px;height:28px;
  border:4px solid #ddd;
  border-top:4px solid #145a32;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 6px;
}
@keyframes spin{100%{transform:rotate(360deg)}}

/* ===== Footer ===== */
.site-footer{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:14px 0;
  margin-top:40px;
  color:#eaeaea;
  font-size:13px;
  opacity:0.85;
  direction:ltr;
  text-align:center;
}

/* ===== Ù…ÙˆØ¨Ø§ÙŠÙ„ ===== */
@media(max-width:600px){
  .side{width:50px}
  .lantern{width:30px;height:54px}
}
</style>
</head>

<body>

<!-- ÙÙˆØ§Ù†ÙŠØ³ -->
<div class="side left">
  <div class="lantern" style="animation-duration:10s;"></div>
  <div class="lantern" style="animation-duration:14s;animation-delay:3s;"></div>
</div>
<div class="side right">
  <div class="lantern" style="animation-duration:12s;"></div>
  <div class="lantern" style="animation-duration:16s;animation-delay:4s;"></div>
</div>

<!-- ØµÙˆØª -->
<audio id="ramadanAudio"
src="https://www.dropbox.com/scl/fi/mdrqo24p7ws6f9ntkp1il/Ramdann22.mp3?rlkey=ifuo7v11gxgptnftufc9vwjp2&st=bjok7i4o&raw=1"
loop preload="auto" playsinline muted></audio>

<!-- Ø¯Ø®ÙˆÙ„ -->
<div class="card active" id="loginCard">
  <h2>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</h2>
  <h2>ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ§Ù†ØªÙ… Ø¨Ø®ÙŠØ± ÙˆØ³Ø¹Ø§Ø¯Ø©</h2>
  <p>Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø±ØºØ¨Ø§Øª Ø¨ÙˆÙ†Ø§Øª Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</p>
  <p>Ø§Ø¬Ù…Ø§Ù„Ù‰ Ø§Ù„Ø¨ÙˆÙ†Ø§Øª 6000 Ø¬Ù†ÙŠØ©</p>
  <button onclick="startSystem()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- ØªØ³Ø¬ÙŠÙ„ -->
<div class="card" id="formCard">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±ØºØ¨Ø©</h3>

  <input id="code" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯" inputmode="numeric">
  <!-- Ù…Ù‡Ù…: Ù…Ø±Ù‘Ø± event -->
  <button onclick="search(event)">Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  <div id="result" style="margin-top:10px"></div>

  <select id="wish">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø±ØºØ¨Ø©</option>
    <option>ÙƒØ§Ø±ÙÙˆØ±</option>
    <option>Ù‡Ø§ÙŠØ¨Ø± ÙˆØ§Ù†</option>
    <option>Ø¬Ù…Ù„Ø© Ù…Ø§Ø±ÙƒØª</option>
    <option>ÙƒØ§Ø²ÙŠÙˆÙ†</option>
    <option>Ø¨ÙŠÙ…</option>
    <option>Ø§Ù„Ø¹Ø¨Ø¯</option>
  </select>

  <button id="saveBtn" onclick="saveWish()">ØªØ³Ø¬ÙŠÙ„</button>

  <!-- Spinner Ù…ÙˆØ­Ù‘Ø¯ -->
  <div id="spinner">
    <div class="loader"></div>
    <span id="spinnerText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°... Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
  </div>
</div>

<footer class="site-footer">
  Â©ï¸ <span id="year"></span> Mohamed Asaad
</footer>

<script>
/* Ø§Ù„Ø³Ù†Ø© */
document.getElementById("year").textContent = new Date().getFullYear();

/* Ù„ÙŠÙ†Ùƒ Apps Script */
const WEB_APP_URL =
"https://script.google.com/macros/s/AKfycbw9LScTOfCj2_UZAS42xnzy1w4g18dA922Af_nyDlvNcV-DZrLXzkKZxA1drSi_P4i_5w/exec";

let currentEmp = null;

/* Ø¯Ø®ÙˆÙ„ */
function startSystem(){
  const a = document.getElementById("ramadanAudio");
  a.muted = false;
  a.play();
  document.getElementById("loginCard").classList.remove("active");
  document.getElementById("formCard").classList.add("active");
}

/* ØªØ­ÙˆÙŠÙ„ Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ© */
function normalizeDigits(v){
  const a="Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©";
  return v.replace(/[Ù -Ù©]/g,d=>a.indexOf(d));
}

/* ===== Ø§Ø³ØªØ¹Ù„Ø§Ù… (Spinner) ===== */
function search(event){
  let code = document.getElementById("code").value.trim();
  code = normalizeDigits(code);

  const btn = event.target;
  const spinner = document.getElementById("spinner");
  const spinnerText = document.getElementById("spinnerText");

  // ÙˆØ§Ø¬Ù‡Ø©
  btn.disabled = true;
  spinnerText.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…... Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
  spinner.style.display = "block";

  fetch(WEB_APP_URL,{
    method:"POST",
    body:new URLSearchParams({
      action:"search",
      code:code
    })
  })
  .then(r => r.text())
  .then(txt => {
    let res;
    try { res = JSON.parse(txt); }
    catch { document.getElementById("result").innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"; return; }

    if(res.status==="ok"){
      currentEmp = { code:code, name:res.name, dept:res.dept };
      document.getElementById("result").innerHTML = `
  <div style="margin-bottom:8px;font-weight:bold;color:#1f8a70;">
    ğŸŒ™ Ù…Ø¹Ù†Ø§ Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ
  </div>
  <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${res.name}</div>
  <div><strong>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong> ${res.dept}</div>
`;
   

    }else{
      currentEmp = null;
      document.getElementById("result").innerHTML = "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    }
  })
  .catch(()=>{
    document.getElementById("result").innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
  })
  .finally(()=>{
    spinner.style.display = "none";
    btn.disabled = false;
  });
}

/* ===== ØªØ³Ø¬ÙŠÙ„ (Spinner) ===== */
function saveWish(){
  if(!currentEmp){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

  const wish = document.getElementById("wish").value;
  if(!wish){ alert("Ø§Ø®ØªØ± Ø§Ù„Ø±ØºØ¨Ø©"); return; }

  const btn = document.getElementById("saveBtn");
  const spinner = document.getElementById("spinner");
  const spinnerText = document.getElementById("spinnerText");

  btn.disabled = true;
  btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
  spinnerText.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±";
  spinner.style.display = "block";

  fetch(WEB_APP_URL,{
    method:"POST",
    body:new URLSearchParams({
      action:"save",
      code:currentEmp.code,
      name:currentEmp.name,
      dept:currentEmp.dept,
      wish:wish
    })
  })
  .then(r=>r.text())
  .then(msg=>{
    if(msg==="OK"){
      alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¨ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ØºØ¨Ø© Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ÙØªØ±Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ğŸŒ™");
      location.reload();
    }else{
      alert(msg==="EXISTS" ? "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ù† Ù‚Ø¨Ù„" : "Ø­Ø¯Ø« Ø®Ø·Ø£");
      btn.disabled=false; btn.innerText="ØªØ³Ø¬ÙŠÙ„";
      spinner.style.display="none";
    }
  })
  .catch(()=>{
    alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…");
    btn.disabled=false; btn.innerText="ØªØ³Ø¬ÙŠÙ„";
    spinner.style.display="none";
  });
}
</script>

</body>

</html>
